<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>
        <record id="view_order_tree_inherit" model="ir.ui.view">
            <field name="name">sale.order form inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="replace">
                    <tree>
                        <field name="name" string="单号" readonly="1" decoration-bf="1"/>
                        <field name="partner_id" readonly="1" string="Supplier"/>
                        <field name="mv"/>
                        <!--                        <field name="invoice_no"/>-->
                        <!--                        <field name="owner_id"/>-->
                        <field name="owner_ref"/>
                        <field name="client_order_ref"/>
                        <field name="team_id" optional="hide"/>
                        <field name="company_id" groups="base.group_multi_company" optional="show" readonly="1"/>
                        <!--                        <field name="amount_untaxed" sum="Total Tax Excluded" widget="monetary" optional="hide"/>-->
                        <!--                        <field name="amount_tax" sum="Tax Total" widget="monetary" optional="hide"/>-->
                        <!--                        <field name="amount_total" sum="Total Tax Included" widget="monetary" decoration-bf="1"-->
                        <!--                               optional="show"/>-->
                        <field name="currency_id" invisible="1"/>
                        <field name="date_order" optional="show"/>
                        <field name="invoice_date" optional="show"/>
                        <field name="location_id" optional="show"/>
                        <field name="warehouse_enter_no" optional="show"/>
                        <field name="state"/>
                        <field name="dest" optional="hide"/>
                        <field name="awb" optional="hide"/>
                        <field name="departure_date" optional="hide"/>
                        <field name="ref" optional="hide"/>
<!--                        <field name="method_id" optional="hide"/>-->
                        <field name="message_attachment_urls" optional="hide"/>
                    </tree>
                </xpath>
            </field>
        </record>

        <record id="view_order_form_inherit" model="ir.ui.view">
            <field name="name">sale.order form inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header/button[@name='%(sale.action_view_sale_advance_payment_inv)d']"
                       position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//header/button[@name='action_preview_sale_order']"
                       position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='pricelist_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='payment_term_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//group[@name='sale_total']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="mv" required="1" readonly="state != 'draft'"/>
                    <!--                    <field name="invoice_no" readonly="state != 'draft'"/>-->
                    <!--                    <field name="owner_id" readonly="state != 'draft'"/>-->
                    <field name="owner_ref" required="1" readonly="state != 'draft'"/>
                    <field name="client_order_ref" readonly="state != 'draft'"/>
                    <field name="delivery_title" readonly="state != 'draft'"/>
                    <field name="email" readonly="state != 'draft'"/>
                    <field name="location_id" readonly="state != 'draft'"/>
                    <field name="order_type" invisible="1"/>
                    <field name="dest" invisible="order_type in ('stock_in')"/>
                    <field name="awb" invisible="order_type in ('stock_in')"/>
                    <field name="departure_date" invisible="order_type in ('stock_in')"/>
                    <field name="ref" invisible="order_type in ('stock_in')"/>
                </xpath>
                <!--                <xpath expr="//field[@name='payment_term_id']" position="after">-->
                <!--                    <field name="arrival_date" readonly="state != 'draft'"/>-->
                <!--                    <field name="warehouse_enter_no" readonly="state != 'draft'"/>-->
                <!--                    <field name="order_type" groups="base.group_no_one" readonly="state != 'draft'"/>-->
                <!--                    <field name="warehouse_id" groups="base.group_no_one"/>-->
                <!--                </xpath>-->
                <!--                <xpath expr="//label[@for='date_order']" position="replace">-->
                <!--                    <label for="date_order" string="Ready Date"/>-->
                <!--                </xpath>-->
                <xpath expr="//group[@name='order_details']" position="replace">
                    <group name="order_details">
                        <field name="validity_date" invisible="1" readonly="state in ['cancel', 'sale']"/>

                        <field name="date_order" readonly="state in ['cancel', 'sale']"/>
                        <field name="arrival_date" readonly="state != 'draft'" invisible="1"/>
                        <field name="warehouse_enter_no" readonly="state != 'draft'"/>
                        <field name="order_type" groups="base.group_no_one" readonly="state != 'draft'"/>
                        <field name="warehouse_id" groups="base.group_no_one"/>
                        <field name="has_active_pricelist" invisible="1"/>
                        <field name="show_update_pricelist" invisible="1"/>
                        <field name="pricelist_id" invisible="1"/>
                        <!--                    <label for="pricelist_id"-->
                        <!--                           groups="product.group_product_pricelist"-->
                        <!--                           invisible="not has_active_pricelist"/>-->
                        <!--                    <div groups="product.group_product_pricelist"-->
                        <!--                         class="o_row"-->
                        <!--                         invisible="not has_active_pricelist">-->
                        <!--                        <field name="pricelist_id" options="{'no_open':True,'no_create': True}"-->
                        <!--                               readonly="state in ['cancel', 'sale']"/>-->
                        <!--                        <button name="action_update_prices" type="object"-->
                        <!--                                string=" Update Prices"-->
                        <!--                                help="Recompute all prices based on this pricelist"-->
                        <!--                                class="btn-link mb-1 px-0" icon="fa-refresh"-->
                        <!--                                confirm="This will update the unit price of all products based on the new pricelist."-->
                        <!--                                invisible="not show_update_pricelist or state in ['sale', 'cancel']"/>-->
                        <!--                    </div>-->
                        <field name="country_code" invisible="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="pricelist_id" invisible="1" readonly="state in ['cancel', 'sale']"
                               groups="!product.group_product_pricelist"/>
                        <field name="tax_country_id" invisible="1"/>
                        <field name="tax_calculation_rounding_method" invisible="1"/>
                        <field name="payment_term_id" options="{'no_open': True, 'no_create': True}" invisible="1"/>
<!--                        <field name="method_id" readonly="state in ['cancel', 'sale']"/>-->
                    </group>
                </xpath>
                <!--                <xpath expr="//field[@name='validity_date']" position="attributes">-->
                <!--                    <attribute name="invisible">1</attribute>-->
                <!--                </xpath>-->
                <!--                <xpath expr="//page[@name='order_lines']/field[@name='order_line']/tree/field[@name='price_subtotal']"-->
                <!--                       position="before">-->
                <!--                    <field name="product_lot_id" optional="hide"/>-->
                <!--                </xpath>-->
                <xpath expr="//page[@name='order_lines']/field[@name='order_line']/tree" position="replace">
                    <tree editable="bottom" limit="200">
                        <field name="sequence" widget="handle"/>
                        <!-- We do not display the type because we don't want the user to be bothered with that information if he has no section or note. -->
                        <field name="display_type" column_invisible="True"/>
                        <field name="product_uom_category_id" column_invisible="True"/>
                        <field name="product_type" column_invisible="True"/>
                        <field name="product_updatable" column_invisible="True"/>
                        <field name="is_downpayment" column_invisible="True"/>
                        <field name="product_id"
                               optional="hide"
                               readonly="not product_updatable"
                               required="not display_type"
                               force_save="1"
                               context="{
                                        'partner_id': parent.partner_id,
                                        'quantity': product_uom_qty,
                                        'pricelist': parent.pricelist_id,
                                        'uom':product_uom,
                                        'company_id': parent.company_id,
                                        'default_lst_price': price_unit,
                                        'default_description_sale': name
                                    }"
                               options="{
                                        'no_open': True,
                                    }"
                               domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                               widget="sol_product_many2one"/>
                        <field name="gross_weight_pc"/>
                        <field name="length"/>
                        <field name="width"/>
                        <field name="height"/>
                        <field name="volume"/>
                        <field name="dimensions"/>
                        <field name="product_template_id"
                               string="Product"
                               column_invisible="True"
                               readonly="not product_updatable"
                               required="not display_type"
                               context="{
                                        'partner_id': parent.partner_id,
                                        'quantity': product_uom_qty,
                                        'pricelist': parent.pricelist_id,
                                        'uom':product_uom,
                                        'company_id': parent.company_id,
                                        'default_list_price': price_unit,
                                        'default_description_sale': name
                                    }"
                               options="{
                                        'no_open': True,
                                    }"
                               domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                               widget="sol_product_many2one"
                               placeholder="Type to find a product..."/>
                        <field name="name" widget="section_and_note_text" optional="show"/>
                        <field name="analytic_distribution" widget="analytic_distribution"
                               optional="hide"
                               groups="analytic.group_analytic_accounting"
                               options="{'product_field': 'product_id', 'business_domain': 'sale_order', 'amount_field': 'price_subtotal'}"/>
                        <field
                                name="product_uom_qty"
                                decoration-info="(not display_type and invoice_status == 'to invoice')"
                                decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                context="{
                                        'partner_id': parent.partner_id,
                                        'quantity': product_uom_qty,
                                        'pricelist': parent.pricelist_id,
                                        'uom': product_uom,
                                        'company_id': parent.company_id
                                    }"
                                readonly="is_downpayment"/>
                        <field column_invisible="True"
                               name="qty_delivered"
                               decoration-info="(not display_type and invoice_status == 'to invoice')"
                               decoration-bf="(not display_type and invoice_status == 'to invoice')"
                               string="Delivered"
                               readonly="qty_delivered_method != 'manual' or is_downpayment"
                               optional="show"/>
                        <field name="qty_delivered_method" column_invisible="True"/>
                        <field column_invisible="True"
                               name="qty_invoiced"
                               decoration-info="(not display_type and invoice_status == 'to invoice')"
                               decoration-bf="(not display_type and invoice_status == 'to invoice')"
                               string="Invoiced"
                               optional="show"/>
                        <field name="qty_to_invoice" column_invisible="True"/>
                        <field name="product_uom_readonly" column_invisible="True"/>
                        <field name="product_uom" column_invisible="True" groups="!uom.group_uom"/>
                        <field
                                name="product_uom"
                                force_save="1"
                                string="UoM"
                                readonly="product_uom_readonly"
                                required="not display_type"
                                context="{'company_id': parent.company_id}"
                                groups="uom.group_uom"
                                options='{"no_open": True}'
                                optional="show"/>
                        <field name="customer_lead"
                               optional="hide"
                               readonly="parent.state not in ['draft', 'sent', 'sale'] or is_downpayment"/>
                        <field name="product_packaging_qty" invisible="not product_id or not product_packaging_id"
                               groups="product.group_stock_packaging" optional="show"/>
                        <field name="product_packaging_id" invisible="not product_id"
                               context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}"
                               groups="product.group_stock_packaging" optional="show"/>
                        <field optional="hide"
                               name="price_unit" column_invisible="True"
                               readonly="qty_invoiced &gt; 0"/>
                        <field name="tax_id"
                               widget="many2many_tags"
                               options="{'no_create': True}"
                               domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                               context="{'active_test': True}"
                               readonly="qty_invoiced &gt; 0 or is_downpayment"
                               optional="hide"/>
                        <field name="discount" string="Disc.%" groups="product.group_discount_per_so_line"
                               optional="hide"/>
                        <field name="is_downpayment" column_invisible="True" optional="hide"/>
                        <field name="price_subtotal" string="Tax excl." invisible="is_downpayment" optional="hide"/>
                        <field name="price_total"
                               string="Tax incl."
                               column_invisible="parent.tax_calculation_rounding_method == 'round_globally'"
                               invisible="is_downpayment"
                               optional="hide"/>
                        <field name="product_lot_id" optional="hide" readonly="1"/>
                        <field name="package_id" optional="hide" readonly="1"/>
                        <!-- Others fields -->
                        <field name="tax_calculation_rounding_method" column_invisible="True"/>
                        <field name="state" column_invisible="True"/>
                        <field name="invoice_status" column_invisible="True"/>
                        <field name="currency_id" column_invisible="True"/>
                        <field name="price_tax" column_invisible="True"/>
                        <field name="company_id" column_invisible="True"/>
                        <field name="hs_code" optional="hide"/>
                        <field name="declaration" optional="hide"/>
                        <field name="assign_package" optional="hide"/>
                    </tree>
                </xpath>
            </field>
        </record>

        <record id="view_sales_order_filter" model="ir.ui.view">
            <field name="name">sale.order.list.select</field>
            <field name="model">sale.order</field>
            <field name="priority" eval="15"/>
            <field name="arch" type="xml">
                <search string="Search Sales Order">
                    <field name="name" string="订单"
                           filter_domain="['|', '|', ('name', 'ilike', self), ('client_order_ref', 'ilike', self), ('partner_id', 'child_of', self)]"/>
                    <field name="partner_id" operator="child_of" string="Supplier"/>
                    <!--                    <field name="owner_id" operator="child_of" string="Owner"/>-->
                    <field name="user_id" string="创建人"/>
                    <!--                    <field name="invoice_no" string="Invoice No"/>-->
                    <field name="mv"/>
                    <field name="owner_ref" string="Owner Ref"/>
                    <field name="warehouse_enter_no" string="Warehouse Enter No"/>
                    <field name="order_line" string="订单行产品"
                           filter_domain="[('order_line.product_id', 'ilike', self)]"/>
                    <field name="client_order_ref"/>
                    <filter string="我的订单" domain="[('user_id', '=', uid)]" name="my_sale_orders_filter"/>
                    <separator/>
                    <filter string="入库订单" domain="[('order_type', '=', 'stock_in')]"
                            name="stock_in_filter"/>
                    <filter string="出库订单" domain="[('order_type', '=', 'stock_out')]"
                            name="stock_out_filter"/>
                    <separator/>
                    <filter name="date_order" string="Ready Date"/>
                    <separator/>
                    <filter string="当日订单" name="today_schedule_order"
                            domain="[('invoice_date', '=', context_today().strftime('%Y-%m-%d'))]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter string="Supplier" name="customer" domain="[]" context="{'group_by': 'partner_id'}"/>
                        <filter string="Ready Date" name="order_month" domain="[]"
                                context="{'group_by': 'date_order'}"/>
                        <filter string="Invoice Date" name="filter_invoice_date" domain="[]"
                                context="{'group_by': 'invoice_date'}"/>
                        <filter string="订单类型" name="order_type" domain="[]" context="{'group_by': 'order_type'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="logistic_sale_action_orders_stock_out" model="ir.actions.act_window">
            <field name="name">出库订单</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form,graph,pivot</field>
            <field name="search_view_id" ref="view_sales_order_filter"/>
            <field name="context">{'default_order_type': 'stock_out'}</field>
            <field name="domain">[('order_type', '=', 'stock_out')]</field>
        </record>

        <record id="logistic_sale_action_orders_stock_in" model="ir.actions.act_window">
            <field name="name">入库订单</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_mode">tree,form,graph,pivot</field>
            <field name="search_view_id" ref="view_sales_order_filter"/>
            <field name="context">{'default_order_type': 'stock_in'}</field>
            <field name="domain">[('order_type', '=', 'stock_in')]</field>
        </record>

        <menuitem id="logistic_sale_menu_order"
                  name="出库订单"
                  action="logistic_sale_action_orders_stock_out"
                  parent="sale.sale_menu_root"
                  sequence="2"/>
        <menuitem id="sale_stock_in_menu"
                  name="入库订单"
                  action="logistic_sale_action_orders_stock_in"
                  parent="sale.sale_menu_root"
                  sequence="1"/>

    </data>
</odoo>
